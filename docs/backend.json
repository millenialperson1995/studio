{
  "entities": {
    "UserProfile": {
      "title": "User Profile",
      "description": "Represents a user account in the system, typically the owner of a workshop.",
      "type": "object",
      "properties": {
        "uid": { "type": "string", "description": "The user's unique ID from Firebase Auth." },
        "email": { "type": "string", "format": "email", "description": "The user's email address." },
        "nome": { "type": "string", "description": "First name of the user." },
        "sobrenome": { "type": "string", "description": "Last name of the user." }
      },
      "required": ["uid", "email", "nome", "sobrenome"]
    },
    "Oficina": {
      "title": "Oficina",
      "description": "Stores the settings and information for a user's workshop.",
      "type": "object",
      "properties": {
        "userId": { "type": "string", "description": "The ID of the user (workshop owner) who owns this data." },
        "nomeEmpresa": { "type": "string", "description": "The name of the workshop/company." },
        "cnpj": { "type": "string", "description": "The company's CNPJ." },
        "endereco": { "type": "string", "description": "Street address." },
        "cidade": { "type": "string", "description": "City." },
        "uf": { "type": "string", "description": "State (Unidade Federativa)." },
        "cep": { "type": "string", "description": "Postal code (CEP)." },
        "telefone": { "type": "string", "description": "The company's phone number." },
        "email": { "type": "string", "format": "email", "description": "The company's contact email." }
      },
      "required": ["userId", "nomeEmpresa", "cnpj", "endereco", "cidade", "uf", "cep", "telefone"]
    },
    "Cliente": {
      "title": "Cliente",
      "type": "object",
      "description": "Represents a customer of a specific workshop.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the Cliente entity." },
        "userId": { "type": "string", "description": "The ID of the user (workshop owner) who owns this client data." },
        "nome": { "type": "string", "description": "The name of the customer." },
        "telefone": { "type": "string", "description": "The customer's phone number." },
        "email": { "type": "string", "description": "The customer's email address.", "format": "email" },
        "cep": { "type": "string", "description": "Postal code (CEP)." },
        "endereco": { "type": "string", "description": "Street address." },
        "numero": { "type": "string", "description": "House/Building number." },
        "bairro": { "type": "string", "description": "Neighborhood." },
        "cidade": { "type": "string", "description": "City." },
        "uf": { "type": "string", "description": "State (Unidade Federativa)." },
        "pontoReferencia": { "type": "string", "description": "Reference point for the address." }
      },
      "required": ["id", "userId", "nome", "telefone", "email", "cep", "endereco", "numero", "bairro", "cidade", "uf"]
    },
    "Veiculo": {
      "title": "Veiculo",
      "type": "object",
      "description": "Represents a vehicle owned by a customer.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the Veiculo entity." },
        "userId": { "type": "string", "description": "The ID of the user (workshop owner) who owns this vehicle data." },
        "clienteId": { "type": "string", "description": "Reference to the client who owns the vehicle." },
        "placa": { "type": "string", "description": "The vehicle's license plate number." },
        "fabricante": { "type": "string", "description": "The vehicle's manufacturer." },
        "modelo": { "type": "string", "description": "The vehicle's model." },
        "ano": { "type": "number", "description": "The vehicle's year of manufacture." },
        "motor": { "type": "string", "description": "Engine information, e.g., '1.6 MSI'." },
        "cilindros": { "type": "string", "description": "Number of cylinders, e.g., '4'." },
        "numeroMotor": { "type": "string", "description": "Vehicle's engine number." }
      },
      "required": ["id", "userId", "clienteId", "placa", "fabricante", "modelo", "ano"]
    },
    "Orcamento": {
      "title": "Orcamento",
      "type": "object",
      "description": "Represents a quotation for services and parts for a specific workshop.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the Orcamento entity." },
        "userId": { "type": "string", "description": "The ID of the user (workshop owner) who owns this quote." },
        "clienteId": { "type": "string", "description": "Reference to Cliente." },
        "veiculoId": { "type": "string", "description": "Reference to Veiculo." },
        "dataCriacao": { "type": "string", "format": "date-time" },
        "dataValidade": { "type": "string", "format": "date-time" },
        "status": { "type": "string" },
        "itens": { "type": "array", "items": { "$ref": "#/backend/entities/ItemOrcamento" } },
        "valorTotal": { "type": "number" },
        "observacoes": { "type": "string" },
        "ordemServicoId": { "type": "string", "description": "The ID of the service order generated from this quote, if any." }
      },
      "required": ["id", "userId", "clienteId", "veiculoId", "dataCriacao", "dataValidade", "status", "itens", "valorTotal"]
    },
    "OrdemServico": {
      "title": "OrdemServico",
      "type": "object",
      "description": "Represents a service order for a vehicle for a specific workshop.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "The ID of the user (workshop owner) who owns this service order." },
        "orcamentoId": { "type": "string" },
        "clienteId": { "type": "string" },
        "veiculoId": { "type": "string" },
        "status": { "type": "string", "enum": ["pendente", "andamento", "concluida", "cancelada"] },
        "statusPagamento": { "type": "string", "description": "The payment status of the service order.", "enum": ["Pendente", "Pago", "Vencido"] },
        "dataEntrada": { "type": "string", "format": "date-time" },
        "dataPrevisao": { "type": "string", "format": "date-time" },
        "dataPagamento": { "type": "string", "format": "date-time" },
        "dataConclusao": { "type": "string", "format": "date-time" },
        "mecanicoResponsavel": { "type": "string" },
        "servicos": { "type": "array", "items": { "$ref": "#/backend/entities/ItemServico" } },
        "pecas": { "type": "array", "items": { "$ref": "#/backend/entities/ItemPeca" } },
        "valorTotal": { "type": "number" },
        "observacoes": { "type": "string" }
      },
      "required": ["id", "userId", "clienteId", "veiculoId", "status", "statusPagamento", "dataEntrada", "dataPrevisao", "mecanicoResponsavel", "servicos", "pecas", "valorTotal"]
    },
     "ItemServico": {
      "title": "ItemServico",
      "type": "object",
      "description": "Represents a single service item within a service order or quote.",
      "properties": {
        "descricao": { "type": "string" },
        "valor": { "type": "number" }
      },
      "required": ["descricao", "valor"]
    },
    "ItemPeca": {
      "title": "ItemPeca",
      "type": "object",
      "description": "Represents a single part item within a service order or quote.",
      "properties": {
        "descricao": { "type": "string" },
        "quantidade": { "type": "number" },
        "valorUnitario": { "type": "number" }
      },
      "required": ["descricao", "quantidade", "valorUnitario"]
    },
    "ItemOrcamento": {
      "title": "ItemOrcamento",
      "type": "object",
      "description": "Represents a single item (part or service) within a quote.",
      "properties": {
        "itemId": { "type": "string" },
        "tipo": { "type": "string", "enum": ["peca", "servico"] },
        "descricao": { "type": "string" },
        "quantidade": { "type": "number" },
        "valorUnitario": { "type": "number" },
        "valorTotal": { "type": "number" }
      },
      "required": ["descricao", "quantidade", "valorUnitario", "valorTotal"]
    },
    "Peca": {
      "title": "Peca",
      "type": "object",
      "description": "Represents a part in a workshop's inventory.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "The ID of the user (workshop owner) who owns this part." },
        "codigo": { "type": "string" },
        "descricao": { "type": "string" },
        "quantidadeEstoque": { "type": "number", "description": "The physical quantity of the part in stock." },
        "quantidadeReservada": { "type": "number", "description": "The quantity of the part reserved for approved quotes." },
        "quantidadeMinima": { "type": "number" },
        "valorCompra": { "type": "number" },
        "valorVenda": { "type": "number" },
        "fornecedor": { "type": "string" },
        "alertaEstoqueBaixo": { "type": "boolean" }
      },
      "required": ["id", "userId", "codigo", "descricao", "quantidadeEstoque", "quantidadeReservada", "valorVenda", "fornecedor", "quantidadeMinima"]
    },
    "Servico": {
      "title": "Servico",
      "type": "object",
      "description": "Represents a service offered by a workshop.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "The ID of the user (workshop owner) who offers this service." },
        "codigo": { "type": "string" },
        "descricao": { "type": "string" },
        "valorPadrao": { "type": "number" },
        "tempoMedio": { "type": "number", "description": "Average time in hours to complete the service." },
        "categoria": { "type": "string", "description": "Category of the service (e.g., Engine, Brakes)." },
        "ativo": { "type": "boolean", "description": "Whether the service is currently active and offered." }
      },
      "required": ["id", "userId", "codigo", "descricao", "valorPadrao", "tempoMedio", "categoria", "ativo"]
    }
  },
  "auth": {
    "providers": ["email"]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": { "$ref": "#/backend/entities/UserProfile" },
          "description": "Stores user profiles. The 'userId' is the document ID, which matches the Firebase Auth UID."
        }
      },
      {
        "path": "/oficinas/{userId}",
        "definition": {
          "entityName": "Oficina",
          "schema": { "$ref": "#/backend/entities/Oficina" },
          "description": "Stores workshop settings. The 'userId' is the document ID, matching the owner's UID."
        }
      },
      {
        "path": "/clientes/{clienteId}",
        "definition": {
          "entityName": "Cliente",
          "schema": { "$ref": "#/backend/entities/Cliente" },
          "description": "Top-level collection for clients. Each document contains a 'userId' field to enforce ownership."
        }
      },
      {
        "path": "/clientes/{clienteId}/veiculos/{veiculoId}",
        "definition": {
          "entityName": "Veiculo",
          "schema": { "$ref": "#/backend/entities/Veiculo" },
          "description": "Subcollection for vehicles under a specific client. Inherits ownership from the parent client."
        }
      },
      {
        "path": "/orcamentos/{orcamentoId}",
        "definition": {
          "entityName": "Orcamento",
          "schema": { "$ref": "#/backend/entities/Orcamento" },
          "description": "Top-level collection for quotes. Each document has a 'userId' for ownership."
        }
      },
      {
        "path": "/ordensServico/{ordemServicoId}",
        "definition": {
          "entityName": "OrdemServico",
          "schema": { "$ref": "#/backend/entities/OrdemServico" },
          "description": "Top-level collection for service orders. Each document has a 'userId' for ownership."
        }
      },
      {
        "path": "/pecas/{pecaId}",
        "definition": {
          "entityName": "Peca",
          "schema": { "$ref": "#/backend/entities/Peca" },
          "description": "Top-level collection for parts. Each document has a 'userId' for ownership."
        }
      },
      {
        "path": "/servicos/{servicoId}",
        "definition": {
          "entityName": "Servico",
          "schema": { "$ref": "#/backend/entities/Servico" },
          "description": "Top-level collection for services. Each document has a 'userId' for ownership."
        }
      }
    ],
    "reasoning": "The data model is designed for a multi-tenant SaaS application where each user (a workshop) owns their data. All primary data collections (clientes, orcamentos, ordensServico, pecas, servicos, oficinas) are at the top level. Every document in these collections MUST contain a 'userId' field that links it to the owner in the '/users' collection. The document ID for '/oficinas/{userId}' and '/users/{userId}' is the user's Auth UID. This structure allows for simple, scalable, and secure ownership-based security rules. For example, a rule on '/clientes/{clienteId}' will be `allow read, write: if request.auth.uid == resource.data.userId;`. This prevents any user from accessing another user's data. The 'veiculos' collection is a subcollection of 'clientes' as a vehicle is intrinsically linked to a single client."
  }
}

    